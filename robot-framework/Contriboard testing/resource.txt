*** Settings ***
Library           ExtendedSelenium2Library

*** Variables ***
${BROWSER}        firefox
${DELAY}          0.1
${ValidUser}      testbaboon@test.com
${ValidPassword}    t3stmonkey
${NewUser}        new45@test.com
${NewPassword}    t3stmonkey
${SERVER}         localhost:8000
${LoginUrl}       http://${SERVER}/login
${BoardUrl}       http://${SERVER}/boards
${RegUrl}         http://${SERVER}/register

*** Keywords ***
Register User
    Assign Id To Element    //div[@class='application']    reactID
    ${rid}    Get Element Attribute    reactID@data-reactid
    Element Text Should Be    //button[@data-reactid='${rid}.1.1.1']    Register    Erronr= Wrong button
    Click Button    //button[@data-reactid='${rid}.1.1.1']
    Wait Until Page Contains Element    //div[@class='form']    timeout=2    error=Form not found
    Location Should Be    ${RegUrl}
    Assign Id To Element    //div[@class='application']    reactID
    ${rid}    Get Element Attribute    reactID@data-reactid
    Input Text    //input[@type='email']    ${NewUser}
    Input Text    //input[@type='password']    ${NewPassword}
    Element Text Should Be    //button[@data-reactid='${rid}.1.0.2']    Register    Error= Wrong Button
    Click Button    //button[@data-reactid='${rid}.1.0.2']
    Wait Until Page Contains Element    //div[@class='form']    timeout=2    error=Form not found
    Location Should Be    ${LoginUrl}

Login New User
    Assign Id To Element    //div[@class='application']    reactID
    ${rid}    Get Element Attribute    reactID@data-reactid
    Wait Until Page Contains Element    //div[@class='form']    timeout=2    error=Form not found
    Input Text    //input[@type='email']    ${NewUser}
    Input Text    //input[@type='password']    ${NewPassword}
    Element Text Should Be    //button[@data-reactid='${rid}.1.0.2']    Login    Error= Wrong Button
    Click Button    //button[@data-reactid='${rid}.1.0.2']
    Wait Until Page Contains Element    //div[@class='board-list']    timeout=2    error=Board list Not Found
    Location Should Be    ${BoardUrl}

Login User
    Assign Id To Element    //div[@class='application']    reactID
    ${rid}    Get Element Attribute    reactID@data-reactid
    Input Text    //input[@type='email']    ${ValidUser}
    Input Text    //input[@type='password']    ${ValidPassword}
    Element Text Should Be    //button[@data-reactid='${rid}.1.0.2']    Login    Error= Wrong Button
    Click Button    //button[@data-reactid='${rid}.1.0.2']
    Wait Until Page Contains Element    //div[@class='board-list']    timeout=2    error=Board list Not Found
    Location Should Be    ${BoardUrl}

New Board
    Assign Id To Element    //div[@class='new-board-preview']    NewBoard
    ${nid}    Get Element Attribute    NewBoard@data-reactid
    Click Element    //div[@data-reactid='${nid}.0']

Random Edit Board
    Get Edit Xpath
    Click Element    ${Expath}
    Input Text    //input[@placeholder='Name']    Board
    Assign Id To Element    //div[@class='dialog-overlay']    reactID
    ${rid}    Get Element Attribute    reactID@data-reactid
    Click Element    //button[@data-reactid='${rid}.0.2.0.0']

Random Open Board
    Get Board Xpath
    Click Element    ${Bxpath}
    Wait Until Page Contains Element    //div[@class='board']    timeout=2    error=Board Not Found

Random Delete Board
    Get Edit Xpath
    Click Element    ${Expath}
    Wait Until Page Contains Element    //button[@class='btn red']    timeout=2    error=Delete Button Not Found
    Click Button    //button[@class='btn red']

Edit Board
    Click Element    //i[@class='fa fa-lg fa-pencil']
    Assign Id To Element    //div[@class='dialog-overlay']    reactID
    ${rid}    Get Element Attribute    reactID@data-reactid
    Input Text    //input[@placeholder='Name']    Board
    Click Element    //button[@data-reactid='${rid}.0.2.0.0']

Open Board
    Assign Id To Element    //div[@class='minimap-container']    Board
    ${bid}    Get Element Attribute    Board@data-reactid
    Click Element    //div[@data-reactid='${bid}']
    Wait Until Page Contains Element    //div[@class='board']    timeout=2    error=Board Not Found

Delete Board
    Click Element    //i[@class='fa fa-lg fa-pencil']
    Wait Until Page Contains Element    //button[@class='btn red']    timeout=2    error=Delete Button Not Found
    Click Button    //button[@class='btn red']

Close Board
    Click Element    //div[@class='logo-content-area']
    Wait Until Page Contains Element    //div[@class='board-list']    timeout=2    error=Board list Not Found
    Location Should Be    ${BoardUrl}

Random Create Ticket
    Get X Coordinate
    Get Y Coordinate
    Double Click Element At Coordinates    //div[@class='board']    ${x}    ${y}

Random Move Ticket
    Get Ticket Xpath
    Get X Move
    Get Y Move
    Drag And Drop By Offset    ${Txpath}    ${yMove}    ${xMove}

Random Delete Ticket
    Get Ticket Xpath
    Double Click Element    ${Txpath}
    Wait Until Page Contains Element    //button[@class='btn red']    timeout=2    error=Delete Button Not Found
    Click Button    //button[@class='btn red']

Random Edit Ticket
    Get Ticket Xpath
    Double Click Element    ${Txpath}
    Wait Until Page Contains Element    //button[@class="btn turquoise"]    timeout=2    error=Delete Button Not Found
    Input Text    xpath=/html/body/div[2]/div/div/div[2]/div/textarea    Typing somenthing
    Click Button    //button[@class="btn turquoise"]

Create Ticket
    Double Click Element    //div[@class='board']
    Wait Until Page Contains Element    //div[@class="content"]    timeout=2    error=Delete Button Not Found
    Assign Id To Element    //div[@class='content']    ticket
    Drag And Drop By Offset    ticket    100    -200

Edit Ticket
    Double Click Element    ticket
    Wait Until Page Contains Element    //button[@class='btn turquoise']    timeout=2    error=Delete Button Not Found
    Input Text    xpath=/html/body/div[2]/div/div/div[2]/div/textarea    Typing somenthing
    Click Button    //button[@class="btn turquoise"]

Delete Ticket
    Double Click Element    ticket
    Wait Until Page Contains Element    //button[@class='btn red']    timeout=2    error=Delete Button Not Found
    Click Button    //button[@class='btn red']

Log Out
    Assign Id To Element    //div[@class='application']    reactID
    ${rid}    Get Element Attribute    reactID@data-reactid
    Click Element    //img[@data-reactid='${rid}.1.1.0']
    Wait Until Page Contains Element    //button[@class='btn red']    timeout=2    error=Delete Button Not Found
    Click Button    //button[@class='btn red']
    Wait Until Page Contains Element    //div[@class='form']    timeout=2    error=Form not found
    Location Should Be    ${LoginUrl}

Input Username
    [Arguments]    ${username}
    Input Text    //input[@type='email']    ${username}

Input Password
    [Arguments]    ${password}
    Input Text    //input[@type='password']    ${password}

Submit Credentials
    Assign Id To Element    //div[@class='application']    reactID
    ${rid}    Get Element Attribute    reactID@data-reactid
    Click Button    //button[@data-reactid='${rid}.1.0.2']

Open Browser To Login Page
    Open Browser    ${LoginUrl}    ${Browser}
    Maximize Browser Window
    Set Selenium Speed    ${DELAY}
    Location Should Be    ${LoginUrl}

Go To Login Page
    Go To    ${LoginUrl}
    Location Should Be    ${LoginUrl}

Get Board Xpath
    [Arguments]    ${min}=1    ${max}=5
    ${int}    Evaluate    random.randint(${min}, ${max})    random,sys
    Set Test Variable    ${Bxpath}    xpath=/html/body/div/div[3]/div/div[${int}]/div[1]

Get Ticket Xpath
    [Arguments]    ${min}=1    ${max}=5
    ${int}    Evaluate    random.randint(${min}, ${max})    random,sys
    Set Test Variable    ${Txpath}    xpath=/html/body/div/div[3]/div[2]/div[1]/div/div[${int}]/div[2]

Get Edit Xpath
    [Arguments]    ${min}=1    ${max}=5
    ${int}    Evaluate    random.randint(${min}, ${max})    random,sys
    Set Test Variable    ${Expath}    xpath=/html/body/div/div[3]/div/div[${int}]/div[2]/i

Get X Move
    [Arguments]    ${min}=-500    ${max}=500
    ${int}    Evaluate    random.randint(${min}, ${max})    random,sys
    Set Test Variable    ${xMove}    ${int}

Get Y Move
    [Arguments]    ${min}=-500    ${max}=500
    ${int}    Evaluate    random.randint(${min}, ${max})    random,sys
    Set Test Variable    ${yMove}    ${int}

Get Y Coordinate
    [Arguments]    ${min}=-500    ${max}=500
    ${int}    Evaluate    random.randint(${min}, ${max})    random,sys
    Set Test Variable    ${y}    ${int}

Get X Coordinate
    [Arguments]    ${min}=-200    ${max}=200
    ${int}    Evaluate    random.randint(${min}, ${max})    random,sys
    Set Test Variable    ${x}    ${int}
